
!!!
%html
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %meta{:charset => "utf-8"}/
    %meta{:content => "IE=edge", "http-equiv" => "X-UA-Compatible"}/
    %title Flowchart Unmapped Risk and Control 
    :css
      input[type=checkbox]{
      \/* Double-sized Checkboxes */
      \-ms-transform: scale(3.5); /* IE */
      \-moz-transform: scale(3.5); /* FF */
      \-webkit-transform: scale(3.5); /* Safari and Chrome */
      \-o-transform: scale(3.5); /* Opera */
      transform: scale(3.5);
      padding: 1px;}
    :css
      .table.table-borderless {border:10px !important;}
      .risk {margin-top:15px;}
      hr.new5 {
      border: 2px solid #D85604;
      border-radius: 5px;}
      th,td{max-width: 50%;}

      
    :css
      .apo{font-size:13px;}
      th{font-size:14px;}
      td{font-size:13px;}
      .tab{ margin-left:40px;}
      .ape{%font-size:24px; text-align:left;}
      .aps{font-size:36px;}

    :css
      span {position:relative; bottom:1.7px; background:#F32013; border-radius:6px; font-size:15px; color:white; font-family:Arial; text-shadow: 0.5px 0.5px black; padding:1px 5px 4px;}

    %h1.text-center.aps Flowchart Unmapped Risk and Control 
    %h2.ape 
    
    


        
      
     
    -# %table.table.table-border
    -#   %thead
    -#     %tr
    -#       %th{:scope => "col"} Risk Name
    -#       %th{:scope => "col"} Level of Risk
    -#       %th{:scope => "col"} Type of Risk
    -#       %th{:scope => "col"} Business Process
    -#   %tbody
    -#     %tr
    -#       %td #{ris.name}
    -#       %td #{ris.level_of_risk.to_s.gsub(/_/, ' ').titlecase}
    -#       %td #{ris.type_of_risk.to_s.gsub(/_/, ' ').titlecase}
    -#       %td #{ris.business_process.name.capitalize}
    -# %br
    %table.table.table-borderless
      %thead
        %tr
          %th.text-center{:scope => "col"} #
          %th.text-center.apo{:scope => "col"} Name
          %th.text-center.apo{:scope => "col"} Level of Risk
          %th.text-center.apo{:scope => "col"} Type of Risk
          %th.text-center.apo{:scope => "col"} Business Processes
      -collect_risk=[]
      -ris = @tags.pluck(:business_process_id).map{|x| BusinessProcess.find(x).risks.pluck(:id)}.flatten.group_by(&:itself).reject{|k,v|v.count>1}.keys
      -ris.each_with_index do |ras,i|
        -rus = Risk.find(ras)
        -if rus.business_processes.present?
          -rus.business_processes.each do |bus|
            %tr
              %td.text-center{:scope => "row"} #{i+1}
              %td.text-center.ape #{rus.name.to_s.gsub(/[^0-9A-Za-z]/, ' ').titlecase.html_safe}
              %td.text-center.apo #{rus.level_of_risk.to_s.gsub(/[^0-9A-Za-z]/, ' ').titlecase.html_safe}
              %td.text-center.apo #{rus.type_of_risk.to_s.gsub(/[^0-9A-Za-z]/, ' ').titlecase.html_safe}
              %td.text-center.apo #{bus&.name&.titlecase}
        -else
          %tr
            %td.text-center{:scope => "row"} #{i+1}
            %td.text-center.ape #{rus.name.to_s.gsub(/[^0-9A-Za-z]/, ' ').titlecase.html_safe}
            %td.text-center.apo #{rus.level_of_risk.to_s.gsub(/[^0-9A-Za-z]/, ' ').titlecase.html_safe}
            %td.text-center.apo #{rus.type_of_risk.to_s.gsub(/[^0-9A-Za-z]/, ' ').titlecase.html_safe}
            %td.text-center.apo No Business Process
        

    %br
    %br




    / %p{:style => "page-break-after:always;"}
    / / %p{:style => "page-break-after:auto;"}
